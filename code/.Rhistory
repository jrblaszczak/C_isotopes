## Import packages
lapply(c("plyr","dplyr","ggplot2","cowplot",
"lubridate","tidyverse"), require, character.only=T)
## Import packages
lapply(c("plyr","dplyr","ggplot2","cowplot",
"lubridate","tidyverse"), require, character.only=T)
# Iteratively import
dat <- read.csv("../data/discharge_data_raw/2018_09_28_Cond_Pink_LolomaiOakCreek.csv", skip=1, header=T)
View(dat)
names(dat)
# Subset
dat <- dat[,c(2:4)]
colnames(dat) <- c("DateTime","Cond","TempC")
# Convert DateTime
dat$DateTime <- as.POSIXct(as.character(dat$DateTime), format="%m/%d/%y %H:%M:%S")
head(dat)
sapply(dat, class)
# Visualize
ggplot(dat, aes(DateTime, Cond))+geom_point()
## Subset based on plot
dat <- subset(dat, DateTime >= as.POSIXct("2018-09-28 07:15:00") & DateTime <= as.POSIXct("2018-09-28 09:00:00")) # Lolomai
################
## Estimate Q ##
################
## Equation
Qint<-function(time,cond, bkg, condmass){
condcorr<-cond-bkg
##below routine integrates
ydiff<- condcorr[-1]+ condcorr[-length(condcorr)]
condint<-sum(diff(time)*ydiff/2)
Q<-condmass/condint
Q
}
sub_bg <- subset(dat, DateTime >= as.POSIXct("2018-09-28 08:30:00") & DateTime <= as.POSIXct("2018-09-28 09:00:00")) #Lolomai
bg_cond <- mean(sub_bg$Cond)
Cond_mass <- 2100*3000
Oak_Lolomai_Clmass <- 3000 # Oak @ Lolomai: 3.00 kg
Oak_Willow_Clmass <- 7210 # Oak @ Willow: 7.21 kg
Blaine_Clmass <- 1209 # Blaine: 1209 g
Beaver_Clmass <- 2084 # Beaver: 2084 g
Cond_mass <- 2100*Oak_Lolomai_Clmass ## *replace depending on calculation
## Calculate Q!
## Units = L/sec
Q <- Qint(as.numeric(dat$DateTime), dat$Cond, bg_cond, Cond_mass)
Q
inj_time <- as.POSIXct("2018-09-28 07:23:00") #Lolomai
peak_time <- dat[which.max(dat$Cond),]$DateTime
time_diff_sec <- as.numeric(peak_time - inj_time)*60
v <- 107.5/time_diff_sec
v
## Distance upstream
Oak_Lolomai_dist_upstream <- 107.5 # Oak @ Lolomai: 107.5 m upstream
Oak_Willow_dist_upstream <- 150 # Oak @ Willow: 150 m upstream
Blaine_dist_upstream <- 50 # Blaine: 50 m upstream
Beaver_dist_upstream <- 217 # Beaver: 217 m upstream
v <- Oak_Lolomai_dist_upstream/time_diff_sec ## *replace depending on calculation
v
w <- 8.6
## Calculate effective depth
z <- (Q/1000)/(w*v)
z
